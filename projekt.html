<!DOCTYPE html>
<html>
<head>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.1.0/topojson.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="sheets.css" type="text/css">
<link rel="stylesheet">
</head>

<body id="body">
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
	<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
		<span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
     </button>
	 <div class="collapse navbar-collapse" id="myNavbar">
		<ul class="nav navbar-nav">

		  <li class="active"><a href="#">World Cup map</a></li>
		  <li><a href="not.html">Number of teams</a></li>
		  <li><a href="nom.html">Number of matches</a></li>
		  <li><a href="goals.html">Goals</a></li>
		  <li><a href="aa.html">Average attendance</a></li>
		  <li><a href="winners.html">Winners</a></li>

		</ul>
	</div>
  </div>
</nav>
<div class="header">
<h1  align="center">World Cup map</h1>
 </div>
<div class="col-sm-2" id="details" width="70 !important"></div>
</div>
<script type="text/javascript">
var width = 1340;
var height = 600;
var offsetL = document.getElementById('body').offsetLeft+(width/2)-650;
var offsetT =document.getElementById('body').offsetTop+(height/2)-204;

var details = [
   {
      "goalspergame":"2.7",
      "totalgoals":"171",
      "numberofmatches":"64",
      "host":"Brazil",
      "averageattendance":"52,918",
      "year":"2014",
      "numberofteams":"32"
   },
   {
      "goalspergame":"2.3",
      "totalgoals":"145",
      "numberofmatches":"64",
      "host":"South Africa",
      "averageattendance":"49,669",
      "year":"2010",
      "numberofteams":"32"
   },
   {
      "goalspergame":"2.3",
      "totalgoals":"147",
      "numberofmatches":"64",
      "host":"Germany",
      "averageattendance":"52,491",
      "year":"2006",
      "numberofteams":"32"
   },
   {
      "goalspergame":"2.5",
      "totalgoals":"161",
      "numberofmatches":"64",
      "host":"Japan",
      "averageattendance":"42,268",
      "year":"2002",
      "numberofteams":"32"
   },
   {
      "goalspergame":"2.7",
      "totalgoals":"171",
      "numberofmatches":"64",
      "host":"France",
      "averageattendance":"43,517",
      "year":"1998",
      "numberofteams":"32"
   },
   {
      "goalspergame":"2.7",
      "totalgoals":"141",
      "numberofmatches":"52",
      "host":"United States",
      "averageattendance":"68,991",
      "year":"1994",
      "numberofteams":"24"
   },
   {
      "goalspergame":"2.2",
      "totalgoals":"115",
      "numberofmatches":"52",
      "host":"Italy",
      "averageattendance":"48,388",
      "year":"1990",
      "numberofteams":"24"
   },
   {
      "goalspergame":"2.5",
      "totalgoals":"132",
      "numberofmatches":"52",
      "host":"Mexico",
      "averageattendance":"46,039",
      "year":"1986",
      "numberofteams":"24"
   },
   {
      "goalspergame":"2.8",
      "totalgoals":"146",
      "numberofmatches":"52",
      "host":"Spain",
      "averageattendance":"40,571",
      "year":"1982",
      "numberofteams":"24"
   },
   {
      "goalspergame":"2.7",
      "totalgoals":"102",
      "numberofmatches":"38",
      "host":"Argentina",
      "averageattendance":"40,678",
      "year":"1978",
      "numberofteams":"16"
   },
   {
      "goalspergame":"2.6",
      "totalgoals":"97",
      "numberofmatches":"38",
      "host":"Germany",
      "averageattendance":"49,098",
      "year":"1974",
      "numberofteams":"16"
   },
   {
      "goalspergame":"3.0",
      "totalgoals":"95",
      "numberofmatches":"32",
      "host":"Mexico",
      "averageattendance":"50,124",
      "year":"1970",
      "numberofteams":"16"
   },
   {
      "goalspergame":"2.8",
      "totalgoals":"89",
      "numberofmatches":"32",
      "host":"United Kingdom",
      "averageattendance":"48,847",
      "year":"1966",
      "numberofteams":"16"
   },
   {
      "goalspergame":"2.8",
      "totalgoals":"89",
      "numberofmatches":"32",
      "host":"Chile",
      "averageattendance":"27,911",
      "year":"1962",
      "numberofteams":"16"
   },
   {
      "goalspergame":"3.6",
      "totalgoals":"126",
      "numberofmatches":"35",
      "host":"Sweden",
      "averageattendance":"23,423",
      "year":"1958",
      "numberofteams":"16"
   },
   {
      "goalspergame":"5.4",
      "totalgoals":"140",
      "numberofmatches":"26",
      "host":"Switzerland",
      "averageattendance":"29,561",
      "year":"1954",
      "numberofteams":"16"
   },
   {
      "goalspergame":"4.0",
      "totalgoals":"88",
      "numberofmatches":"22",
      "host":"Brazil",
      "averageattendance":"47,511",
      "year":"1950",
      "numberofteams":"13"
   },
   {
      "goalspergame":"4.7",
      "totalgoals":"84",
      "numberofmatches":"18",
      "host":"France",
      "averageattendance":"20,872",
      "year":"1938",
      "numberofteams":"15"
   },
   {
      "goalspergame":"4.1",
      "totalgoals":"70",
      "numberofmatches":"17",
      "host":"Italy",
      "averageattendance":"21,352",
      "year":"1934",
      "numberofteams":"16"
   },
   {
      "goalspergame":"3.9",
      "totalgoals":"70",
      "numberofmatches":"18",
      "host":"Uruguay",
      "averageattendance":"32,808",
      "year":"1930",
      "numberofteams":"13"
   }
]
var dataSet = {};

var projection = d3.geo.mercator()
	.center([0, 0])
	.scale(140)
	.translate([635, 410])
	.rotate([-10, 0]);
var path = d3.geo.path()
	.projection(projection);

var svg = d3.select("body").append("svg")
	.attr("width", width)
	.attr("height", height)
	.attr("class", "svg")
	.style("background", "lightblue");
  	
var div = d3.select("body").append("div")	
    .attr("class", "tooltip")
    .style("opacity", 0);
	
var tooltip = d3.select("body").append("div").attr("class", "tooltip hidden");

var detailsShow = svg.append("g")
	.attr("transform", "translate(10, 25)")
	.style("fill", "none")
	.append("text").text("");	
	
		
d3.json("world.json", function(error, world) { // Karta svijeta
		var data = world;
		var states = svg.selectAll("path.country")
		.data(data.features)
		.enter()
		.append("path")
		.attr("class", "country")
		//.attr("id", function(d) { return d.id; })
		.attr("id", function(d) { return d.properties.name; })
		.attr("d", path) 
		.style("fill", "lightgreen")
		.style("stroke", "gray")
		.style("stroke-width", 1)
		.style("stroke-opacity", 1)
		.on("mouseover", function(d) {	
			if(d3.select(this).style("fill")=="rgb(255, 165, 0)"){}
			else{
			d3.select(this)
				.transition()
				.style("fill", "green");	
			}				
		})	
		.on("mousemove", function(d,i) {
			var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
				tooltip.classed("hidden", false)
				.attr("style", "left:"+(mouse[0]+offsetL+200)+"px;top:"+(mouse[1]+offsetT)+"px")
				.html(d.properties.name)
				.transition()		
				.duration(200)		
				.style("opacity", .9);
		})
		.on("click", showDetails)
		.on("mouseout",  function(d,i) {
			tooltip.classed("hidden", true)
				.transition()		
				.duration(500)		
				.style("opacity", 0);
				if(d3.select(this).style("fill")=="rgb(255, 165, 0)"){}
				else{
				d3.select(this)
					.transition()
					.style("fill", "lightgreen");	
				}		
			
      }); 
	

});


function showDetails(d){
	var i = 0;
	var kliznik = document.getElementById("timeslide").value;
	while (d.properties.name != details[i].host) i++;
	if(kliznik == details[i].year){
		var detailsText = "<b>Host: </b>" + details[i].host +"<br>"+ "<b>Number of teams: </b>"+ details[i].numberofteams +"<br>"+"<b>Number of matches: </b>"+ details[i].numberofmatches+"<br>"+ "<b>Goals per game: </b>" + details[i].goalspergame +"<br>"+"<b>Average attendance: </b>"+ details[i].averageattendance;
		//detailsShow.style("fill", "blue").text(detailsText).style("font", "bold 14pt TimesNewRoman");
		document.getElementById("details").innerHTML=detailsText;
	}
}

function prikaziBroj(){  
	var SliderValue = document.getElementById("timeslide").value;
		document.getElementById('range').innerHTML=""+SliderValue;
		obojajDrzavu();
	return SliderValue;
}
var odbojana=null;
function obojajDrzavu(){
	if(odbojana!=null){
		var vrati = document.getElementById(odbojana);
		vrati.style.fill="lightgreen";
	}
	var SliderValue = document.getElementById("timeslide").value;
	var i = 0; var countryName="";
	while(details[i].year != SliderValue) i++;
	countryName=details[i].host;
	var obojana = document.getElementById(countryName);
	obojana.style.fill="orange";
	
	odbojana=countryName;
}

</script>
	<div id="sliderContainer" align="center">
        <input id="timeslide" min="1930" max="2014" step="4" value="1930" type="range" onchange="prikaziBroj(this.value);"/><output id="sliderVal"></output><br>
        <span id="range">1930</span>
    </div>
</body>
</html>